<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Particle sphere</title>
		<meta charset="utf-8">

		<style type="text/css">
			body {
				background-color: #000000;
				margin: 0px;
				overflow: hidden;
			}

			#value{
				display: none;
				position: absolute;
				padding: 20px;
				right: 0px;
				background-color: white;
			}
		</style>
		
	</head>
	<body>
		<div id="value">Value</div>
		<script src="three.min.js"></script>

		<script>

		// TODO : PLUG INTO SOUNDCLOUDS API? anim using stardistance

			// the main three.js components
			var camera, scene, renderer,

			// to keep track of the mouse position
				mouseX = 0, mouseY = 0,

			// an array to store our particles in
				particles = [];

			windowWidth = window.innerWidth;
			windowHeight = window.innerHeight;
			starDistance = 500;
			baseZoom = 1100;
			zoomMultiplier = 2000;
			panMultiplier = 2000;
			particleSize = 2.5;
			numberParticles = 3000;

			// let's get going! 
			init();

			function init() {

				// Camera params : 
				// field of view, aspect ratio for render output, near and far clipping plane. 
				camera = new THREE.PerspectiveCamera(80, windowWidth / window.innerHeight, 1, 4000 );
	
				// move the camera backwards so we can see stuff! 
				// default position is 0,0,0. 
				camera.position.z = baseZoom;

				// the scene contains all the 3D object data
				scene = new THREE.Scene();
				
				// camera needs to go in the scene 
				scene.add(camera);
	
				// and the CanvasRenderer figures out what the 
				// stuff in the scene looks like and draws it!
	 
				renderer = new THREE.CanvasRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );
	
				// the renderer's canvas domElement is added to the body
				document.body.appendChild( renderer.domElement );

				makeParticles(); 
			
				// add the mouse move listener
				document.addEventListener( 'mousemove', updateMouseCoords, false );

				
				// render 30 times a second (should also look 
				// at requestAnimationFrame) 
				int = setInterval(update,1000/30); 
			
			}

			function s(){ // stop
				clearInterval(int)
			}

			// the main update function, called 30 times a second

			function update() {

				updateParticles();

				// and render the scene from the perspective of the camera
				renderer.render( scene, camera );

			}

			function spherize(x,y,z){
				var d = 1 / Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2) + Math.pow(z, 2));
				x *= d;
				y *= d;
				z *= d;
				return {x: x, y: y, z: z}
			}

			function unspherize(x,y,z){
				var d = 1 * Math.pow(Math.sqrt(x) + Math.sqrt(y) + Math.sqrt(z), 2)
				x *= d;
				y *= d;
				z *= d;
				return {x: x, y: y, z: z}
			}

			// creates a random field of Particle objects
			function makeParticles() { 
				
				var particle, material; 

				//CREATE THE SPHERE
				for (var i = 1; i < numberParticles; i++){

					var x = -1 + Math.random() * 2;
					var y = -1 + Math.random() * 2;
					var z = -1 + Math.random() * 2;
					var sphere = spherize(x,y,z);

					material = new THREE.ParticleCanvasMaterial( { color: 0xffffff, program: particleRender } );
					particle = new THREE.Particle(material);

					particle.position.x = sphere.x*starDistance;
					particle.position.y = sphere.y*starDistance;
					particle.position.z = sphere.z*starDistance;

					// scale it up a bit
					particle.scale.x = particle.scale.y = particleSize;

					// add it to the scene
					scene.add( particle );
		
					// and to the array of particles. 
					particles.push(particle); 
				}

				
			}
			
			// there isn't a built in circle particle renderer 
			// so we have to define our own. 

			function particleRender( context ) {
				// we get passed a reference to the canvas context
				context.beginPath();
				// and we just have to draw our shape at 0,0 - in this
				// case an arc from 0 to 2Pi radians or 360ยบ - a full circle!
				context.arc( 0, 0, 1, 0,  Math.PI * 2, true );
				context.fill();
			};

			
			// moves all the particles dependent on mouse position
			
			function updateParticles() { 
				// iterate through every particle
				for(var i=0; i<particles.length; i++) {
		
					particle = particles[i]; 

		
					//move cam zoom in out on mouseY
					var cameraOffset = mouseY/windowHeight - 0.5;
					camera.position.z = baseZoom + cameraOffset * zoomMultiplier;

					//rotate cam left right on mouseX
					var cameraOffset = mouseX/windowWidth - 0.5;
					camera.position.x = cameraOffset * panMultiplier * -1;
					camera.lookAt(new THREE.Vector3(0,0,0));

				}
	
			}
		
		// called when the mouse moves
			function updateMouseCoords( event ) {
				// store the mouseX and mouseY position 
				mouseX = event.clientX;
				mouseY = event.clientY;
			}

		</script>
	</body>
</html>
